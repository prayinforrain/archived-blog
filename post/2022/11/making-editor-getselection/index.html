<!doctype html><html lang=ko itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>마크다운 만들기 - getSelection [2/3] - PrayinForRain.dev</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="prayinforrain"><meta name=description content="모헤윰의 에디터 만들기 시리즈 모아보기 에디터 만들기 - ContentEditable [1/3] 에디터 만들기 - getSelection [2/3] 에디터 만들기 - Markdown [3/3] 아니???????? 두 번째 글이 파서가 아니였네요. 저는 사실 이 글이 2부작이길 간절히 바랬는데, 1편에서 만든 에디터에 너무 끔찍한 버그가 있어서 이에 대해 정리해 보고자 합니다. 이걸로 3시간을 씨름하고 있었지만 모헤윰의 TIL 문서가 풍성해지"><meta name=keywords content="Hugo,Frontend,React"><meta name=generator content="Hugo 0.111.3"><link rel=canonical href=https://prayinforrain.github.io/post/2022/11/making-editor-getselection/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/sass/jane.min.695436e31b5cfcf8122719bb738223bb41fae856f2a3a9fa4b8a2889776a728c.css integrity="sha256-aVQ24xtc/PgSJxm7c4Iju0H66Fbyo6n6S4ooiXdqcow=" media=screen crossorigin=anonymous><meta property="og:title" content="마크다운 만들기 - getSelection [2/3]"><meta property="og:description" content="모헤윰의 에디터 만들기 시리즈 모아보기 에디터 만들기 - ContentEditable [1/3] 에디터 만들기 - getSelection [2/3] 에디터 만들기 - Markdown [3/3] 아니???????? 두 번째 글이 파서가 아니였네요. 저는 사실 이 글이 2부작이길 간절히 바랬는데, 1편에서 만든 에디터에 너무 끔찍한 버그가 있어서 이에 대해 정리해 보고자 합니다. 이걸로 3시간을 씨름하고 있었지만 모헤윰의 TIL 문서가 풍성해지"><meta property="og:type" content="article"><meta property="og:url" content="https://prayinforrain.github.io/post/2022/11/making-editor-getselection/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-11-24T00:53:55+09:00"><meta property="article:modified_time" content="2022-11-24T00:53:55+09:00"><meta itemprop=name content="마크다운 만들기 - getSelection [2/3]"><meta itemprop=description content="모헤윰의 에디터 만들기 시리즈 모아보기 에디터 만들기 - ContentEditable [1/3] 에디터 만들기 - getSelection [2/3] 에디터 만들기 - Markdown [3/3] 아니???????? 두 번째 글이 파서가 아니였네요. 저는 사실 이 글이 2부작이길 간절히 바랬는데, 1편에서 만든 에디터에 너무 끔찍한 버그가 있어서 이에 대해 정리해 보고자 합니다. 이걸로 3시간을 씨름하고 있었지만 모헤윰의 TIL 문서가 풍성해지"><meta itemprop=datePublished content="2022-11-24T00:53:55+09:00"><meta itemprop=dateModified content="2022-11-24T00:53:55+09:00"><meta itemprop=wordCount content="3420"><meta itemprop=keywords content="moheyum,"><meta name=twitter:card content="summary"><meta name=twitter:title content="마크다운 만들기 - getSelection [2/3]"><meta name=twitter:description content="모헤윰의 에디터 만들기 시리즈 모아보기 에디터 만들기 - ContentEditable [1/3] 에디터 만들기 - getSelection [2/3] 에디터 만들기 - Markdown [3/3] 아니???????? 두 번째 글이 파서가 아니였네요. 저는 사실 이 글이 2부작이길 간절히 바랬는데, 1편에서 만든 에디터에 너무 끔찍한 버그가 있어서 이에 대해 정리해 보고자 합니다. 이걸로 3시간을 씨름하고 있었지만 모헤윰의 TIL 문서가 풍성해지"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>prayinforrain.dev</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=https://prayinforrain.github.io/>Home</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://prayinforrain.github.io/post/>Archives</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://prayinforrain.github.io/tags/>Tags</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://prayinforrain.github.io/categories/>Categories</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://prayinforrain.github.io/about/>About</a></li></ul></nav><link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css><link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class="header container"><div class=logo-wrapper><a href=/ class=logo>prayinforrain.dev</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://prayinforrain.github.io/>Home</a></li><li class=menu-item><a class=menu-item-link href=https://prayinforrain.github.io/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=https://prayinforrain.github.io/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=https://prayinforrain.github.io/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=https://prayinforrain.github.io/about/>About</a></li></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight wallpaper"><div class=content-wrapper><div id=content class="content container"><article class="post bg-white"><header class=post-header><h1 class=post-title>마크다운 만들기 - getSelection [2/3]</h1><div class=post-meta><div class=post-meta-author>by
<a href=/about><span class=post-meta-author-name>prayinforrain</span></a></div><div class=post-meta-time title="2022-11-24 00:53:55"><time datetime=2022-11-24>2022-11-24</time></div><div class=post-meta__right><span class=post-meta-more>7 min read</span><div class=post-meta-category><a href=https://prayinforrain.github.io/categories/moheyum/>moheyum</a></div></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>목차</h2><div class=post-toc-content><hr><nav id=TableOfContents><ul><li><a href=#-첫-단추가-중요하다>😢 첫 단추가 중요하다</a></li><li><a href=#-windowsgetselection>🖱️ windows.getSelection()</a><ul><li><a href=#contenteditable의-문제>contenteditable의 문제</a></li><li><a href=#type-selection>type Selection</a></li><li><a href=#anchornode는-node다>anchorNode는 node다</a><ul><li><a href=#텍스트-노드를-아시나요>텍스트 노드를 아시나요?</a></li></ul></li><li><a href=#nodenodetype>Node.nodeType</a></li></ul></li><li><a href=#-오버엔지니어링의-길목에서>🤦 오버엔지니어링의 길목에서</a></li></ul></nav></div></div><div class=post-content><p><strong>모헤윰</strong>의 에디터 만들기 시리즈 모아보기<br><a href=https://prayinforrain.github.io/post/2022/11/making-editor-contenteditable/>에디터 만들기 - ContentEditable [1/3]</a><br><a href=https://prayinforrain.github.io/post/2022/11/making-editor-getselection/>에디터 만들기 - getSelection [2/3]</a><br><a href=https://prayinforrain.github.io/post/2022/12/making-editor-markdown/>에디터 만들기 - Markdown [3/3]</a></p><hr><p>아니???????? 두 번째 글이 파서가 아니였네요. 저는 사실 이 글이 2부작이길 간절히 바랬는데, 1편에서 만든 에디터에 너무 끔찍한 버그가 있어서 이에 대해 정리해 보고자 합니다. 이걸로 3시간을 씨름하고 있었지만 모헤윰의 TIL 문서가 풍성해지고 있으니 긍정적이게 생각해야겠죠?</p><blockquote><p>💡 이 글은 Window 10, Chrome 107.0.5304.107 버전을 기준으로 작성되었습니다. 일부 환경에 따라 다르게 작동하는 부분이 있을 수 있습니다.</p></blockquote><h1 id=-첫-단추가-중요하다>😢 첫 단추가 중요하다</h1><p><img src=/image/post/2022/11/making-editor-getselection/md_editor_2_01.png alt=Untitled></p><p>지금 만든 <code>contenteditable div</code>는 치명적 문제가 있습니다. <code>contenteditable</code>이 사진처럼 첫 줄의 텍스트를 div 태그로 감싸주지 않는다고 언급한 문제가 기억 나시나요? 사실 저는 처음 글에서 첫 줄 문제가 해결된 척 이야기한 바 있죠. 특정 상황에서는 여전히 <code>contenteditable div</code>에 직접 텍스트를 입력할 수 있었지만, 솔직하게 그 때는 어차피 syntax highlighting을 지원하지 않을 거라 생각해 쉬쉬하기로 했습니다. 그런데 아니나 다를까, 붙여넣기에서 문제가 발생했습니다.</p><p><img src=/image/post/2022/11/making-editor-getselection/md_editor_2_02.png alt=Untitled></p><p>아무 입력도 되어 있지 않은 <code>contenteditable div</code>에 붙여넣기를 하면 위와 같은 오류가 납니다. 이 상태에서 다시 붙여넣기를 하면 그 때부턴 정상적으로 작동하는데, 어차피 이런 에러 쯤이야 콘솔을 열어놓고 웹서핑을 하는 개발자가 아니고서야 무시할 수 있는 수준이니 넘어갈 수 있겠지만, 결정적으로 붙여넣기 후 <strong>커서가 붙여넣기 한 글귀의 끝으로 이동하지 않았습니다</strong>. 아니나 다를까 탭 키에 대해서 구현했던 코드도 같은 오류가 있네요.</p><p>오늘은 이 오류의 원인과 해결 과정에 대해 기록하는 글을 써 보겠습니다.</p><h1 id=-windowsgetselection>🖱️ windows.getSelection()</h1><h2 id=contenteditable의-문제>contenteditable의 문제</h2><p>저번 글에서 공부했던 바와 같이, <code>contenteditable div</code>는 일반적인 입력 동작이 제대로 이루어지지 않습니다. 착한 사용자가 차분히 글을 입력한다고 해도 첫 줄만 <code>div</code> 태그로 감싸주지 않는다거나, 붙여넣기를 하면 대뜸 원본의 서식이 그대로 적용된 글귀가 입력되기도 합니다.</p><p><img src=/image/post/2022/11/making-editor-getselection/md_editor_2_03.png alt=Untitled></p><p>대충 이런 느낌이죠. 그 외에도 수정을 어떻게 하느냐에 따라 결과물이 묘하게 달라지기도 하는 등, 너무나 다양한 문제가 산재해 있습니다. 서론이 너무 길었네요. 그냥 <code>con..어쩌구</code>에 대해 처음 글을 쓸 때 이런 문제들이 있다고 설명할 걸 그랬어요.</p><p>아무튼 이런 불쾌한 동작들을 해결하기 위해, <code>keydown</code>, <code>keyup</code>, <code>paste</code> 등 다양한 이벤트 리스너를 바인딩해서 직접 이런 제스쳐를 구현해야만 했습니다. 그 과정에서 소개했던 것이 바로 <code>windows.getSelection()</code>이였죠.</p><p><img src=/image/post/2022/11/making-editor-getselection/md_editor_2_04.png alt=Untitled></p><h2 id=type-selection>type Selection</h2><p>우선 이 녀석이 제공해주는 <code>Selection</code> 타입 객체의 property를 보겠습니다.</p><table><thead><tr><th>이름</th><th>설명</th></tr></thead><tbody><tr><td>anchorNode</td><td>선택이 시작된 지점(=드래그 시작 지점)의 노드를 참조합니다.</td></tr><tr><td>anchorOffset</td><td>선택이 시작된 지점의 anchorNode상에서의 위치를 나타냅니다.</td></tr><tr><td>focusNode</td><td>선택이 끝난 지점(=드래그 종료 지점)의 노드를 참조합니다.</td></tr><tr><td>focusOffset</td><td>선택이 끝난 지점의 focusNode상에서의 위치를 나타냅니다.</td></tr><tr><td>type</td><td>블록 지정시 Range, 단일 커서는 Caret을 갖습니다.</td></tr></tbody></table><p>큰 의미 없거나 정식 스펙이 아닌 경우는 제외하고 이 정도를 알고 있으면 되겠습니다. 드래그 시작과 종료 지점을 명시한 이유는 저번 글에서 언급했던 것처럼 드래그에는 방향이 있기 때문이죠. Caret의 경우에는 항상 두 프로퍼티가 같은 값을 가질 것입니다.</p><p><code>Selection</code> 타입은 제공하는 method도 있습니다. 한번 알아보겠습니다.</p><table><thead><tr><th>이름</th><th>설명</th></tr></thead><tbody><tr><td>getRangeAt(index)</td><td>현재 선택된 index번째 Range 범위를 반환합니다. 다중 선택이 지원되는 브라우저가 아닌 경우 보통 index는 0이 최대입니다.</td></tr><tr><td>addRange(range)</td><td>현재 선택된 Range에 더해 range를 함께 선택합니다. 다중 선택이 지원되는 브라우저가 아닌 경우 range만이 재선택됩니다.</td></tr><tr><td>collapse(node, offset?)</td><td>node의 offset 위치를 선택합니다.</td></tr><tr><td>containsNode(node, partialContainment?)</td><td>node가 선택 Range 안에 포함되는지 여부를 반환합니다. partialContainment가 true인 경우 일부만 포함되어 있어도 true를 반환합니다.</td></tr></tbody></table><p>훨씬 종류가 많지만 쓰이지 않을 것 같아 길게 적지 않았습니다. 그 외에 <code>Selection</code> 타입 객체는 각 프로퍼티에 대해 얕은 참조를 제공하기 때문에 같은 이름으로 참조해도 참조 시점에 따라 값이 변할 수 있다는 특성이 있겠네요. 여기서 제가 사용했던 메소드는 <code>collapse</code>였습니다. 대충 <code>getSelection()</code>으로 받은 <code>anchorNode</code>를 그대로 사용하고, <code>anchorOffset + 추가한 문자열 길이</code>로 위치를 잡는 식이죠.</p><h2 id=anchornode는-node다>anchorNode는 node다</h2><p>그런데 이 <code>anchorOffset</code>은 상황에 따라 다르게 사용해야 합니다. 이게 무슨 소리냐면, 이 녀석을 1로 지정하면 커서가 끝으로 갈 때가 있고, 두 번째 글자로 커서가 이동할 때가 있다는 말이죠.</p><p><img src=/image/post/2022/11/making-editor-getselection/md_editor_2_05.gif alt=복사맨2.gif></p><p>두 번째 글자로 커서가 가는건 이해가 가는데, 처음엔 왜 끝으로 갔던 걸까요? 그 비밀은 <code>getSelection</code>이 참조하던 <code>anchorNode</code>에 있습니다. <strong>첫 번째 붙여넣기와 그 이후의 붙여넣기의 anchorNode가 다르기 때문</strong>이죠. 첫 번째 붙여넣기는 <code>contenteditable div</code>를, 그 이후에는 해당 라인의 div..도 아니라 <code>그 div의 **텍스트 노드**</code>를 참조하고 있습니다.</p><h3 id=텍스트-노드를-아시나요>텍스트 노드를 아시나요?</h3><p>위에 제가 <code>console.log</code>를 찍어본 사진에는 <code>anchorNode</code>에 <code>text</code>라고 쓰여 있었습니다. 저는 <code>contenteditable div</code>의 자식 <code>div</code>중 하나를 선택하고 있었는데 말이죠. 즉 <code>getSelection</code>은 선택중인 텍스트 노드까지 따져서 참조한다는 특징을 알 수 있습니다. 텍스트 노드라.. 딱히 어느 태그에 포함되어 있지 않으면서 애매하게 텍스트만 들어있는 바로 그 <code>innerText</code>를 텍스트 노드라고 부르는 모양입니다.</p><p><img src=/image/post/2022/11/making-editor-getselection/md_editor_2_06.png alt=Untitled></p><p>바로 요 녀석인데요, 텍스트 노드는 다른 노드와 다르게 조금 특이한 성질을 갖습니다. 다르다고 하나, 아무튼 Node 인터페이스를 상속하지만 HTML Element는 아니기 때문에 다루기가 굉장히 까다롭습니다.</p><ul><li>innerText가 비어있는, 즉 <code>‘’</code>인 Element는 텍스트 노드가 없습니다.</li><li>부모의 <code>childNodes</code>같은 프로퍼티로 접근할 수 있지만, 고정된 인덱스에 있지는 않습니다.<ul><li>즉 다른 형제 노드와의 순서에 따라 인덱스가 변합니다..</li></ul></li></ul><p>다시 돌아와서 <code>collapse</code>에 제공한 <code>offset</code>이 어째서 텍스트 상의 위치를 가리키지 않았느냐, 노드상에서의 <strong>offset은 텍스트 노드를 제외하고는 자식 노드의 인덱스를 가리키기 때문</strong>이죠. 즉 아래 과정과 같습니다.</p><p>첫 번째 복사했을 때에는 <code>anchorNode</code>가 <code>contenteditable div</code>였기 때문에, <code>offset = 1</code>에 해당하는 위치는 아래와 같습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>contenteditable</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>textNode</span><span class=p>&gt;</span><span class=err>복사한</span> <span class=err>글귀입니다</span><span class=p>&lt;/</span><span class=nt>textNode</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=c>&lt;!--</span> <span class=err>여기</span><span class=o>!</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>이렇게 커서를 이동시키고 나면, <code>div</code> 태그 안의 입력은 모두 텍스트 노드 안으로 들어가게 되므로 커서는 텍스트 노드가 끝나기 직전 위치로 자동으로 보정되게 됩니다. 표현하자면 아래처럼 되겠군요.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>contenteditable</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>textNode</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=err>복사한</span> <span class=err>글귀입니다</span>
</span></span><span class=line><span class=cl>		<span class=c>&lt;!--</span> <span class=err>여기</span><span class=o>!</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>textNode</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>이 상태에서 한번 더 붙여넣기를 한다면 끝에 자연스럽게 붙여넣기가 되지만, 이번에 참조하는 <code>anchorNode</code>는 텍스트노드로 변경되어 offset이 가리키는 위치는 처음 원했던 바로 그 텍스트에서의 위치가 됩니다. 두 번째 붙여넣기를 완료한 후의 커서 상태는 아래와 같이 됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>contenteditable</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>textNode</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=err>복</span><span class=c>&lt;!--</span> <span class=err>여기</span><span class=o>!</span> <span class=o>--&gt;</span><span class=err>사한</span> <span class=err>글귀입니다복사한</span> <span class=err>글귀입니다</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>textNode</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>정말 끔찍하군요. offset이 노드의 타입에 따라 다르게 적용된다니! 아니 그 이전에 왜 <code>anchorNode</code>는 처음부터 텍스트노드를 잡아 주지 않는거죠?</p><h2 id=nodenodetype>Node.nodeType</h2><p>다행히 이 문제를 바로잡을 방법이 있었습니다. 바로 Node 인터페이스가 제공하는 <code>nodeType</code>인데요, 이 녀석이 1이면 Element, 3이면 Text 노드라고 하네요. 그 말인 즉 <code>anchorNode</code>가 1이거나 3일 때 다른 한 쪽으로 변환해서 통일해주면 되는데.. 앞에서 언급했듯 텍스트 노드는 참조하는 것 자체가 여간 어려운 일이 아닙니다. 그래서 제가 해결한 방법은 <code>nodeType</code>에 따라 offset을 다르게 사용하는 것입니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>position</span> <span class=o>=</span> <span class=nx>anchorNode</span><span class=p>.</span><span class=nx>nodeType</span> <span class=o>===</span> <span class=mi>3</span> <span class=o>?</span> <span class=nx>anchorOffset</span> <span class=o>+</span> <span class=nx>data.length</span> : <span class=kt>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>getSelection</span><span class=p>()</span><span class=o>?</span><span class=p>.</span><span class=nx>collapse</span><span class=p>(</span><span class=nx>anchorNode</span><span class=p>,</span> <span class=nx>position</span><span class=p>);</span>
</span></span></code></pre></div><p>텍스트 노드이면 정상적으로 길이를 더해서 끝자리를 잡아주고, 엘리먼트이면 1의 offset을 대입합니다. 이게 가능한 이유는 이 문제가 발생하는 케이스가 빈 칸에 최초 입력 시에만 발생하기 때문인데, 새로운 케이스가 발견되면 저 1을 무척 피곤하고 귀찮은 변수로 바꿔 주어야 겠네요.</p><h1 id=-오버엔지니어링의-길목에서>🤦 오버엔지니어링의 길목에서</h1><p><img src=/image/post/2022/11/making-editor-getselection/md_editor_2_07.gif alt=고쳤맨.gif></p><p>처음에는 아주 간단한 에디터를 생각했는데, 그 <em>간단한</em> 에디터 뒤에 얼마나 깊은 심연이 있는지 몸소 두들겨 맞게 되는 요즘입니다. <code>input</code>이나 <code>textarea</code>를 썼으면 이런 긴 글을 두 개나 쓸 필요가 없었을텐데, 제가 무슨 부귀영화를 누리자고 <code>contenteditable</code>을 쓰자고 했을까요?</p><p>그럼에도 불구하고 새로운 경험을 하고 글을 쓸 수 있어서 정말 즐겁습니다. 데모 발표 시간에도 제가 즐거워해야 할텐데요, 다음 글은 드디어 마크다운을 파싱하는 과정에 대해 써볼 예정입니다. 지금 어느 난관에 부딪혀 멈춰 있는데, 여유가 된다면 아마 6주차에 리팩토링을 할 것 같네요. 화이팅!</p></div><footer class=post-footer><div class=post-tags>tags:
<a href=https://prayinforrain.github.io/tags/moheyum/>moheyum</a></div><nav class=post-nav><a class=prev href=/post/2022/12/making-editor-markdown/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg></i><span class="prev-text nav-default">마크다운 만들기 - Markdown [3/3]</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/2022/11/making-editor-contenteditable/><span class="next-text nav-default">마크다운 만들기 - contentEditable [1/3]</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg></i></a></nav></footer></article><div class="post bg-white"><script src=https://giscus.app/client.js data-repo=prayinforrain/prayinforrain.github.io data-repo-id=R_kgDOItUJmA data-category=Announcements data-category-id=DIC_kwDOItUJmM4CTXa0 data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></div></div></div></main><footer id=footer class=footer><div class=icon-links><a href=mailto:prayinforrain@naver.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg></a><a href=https://github.com/prayinforrain rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg></a><a href=https://prayinforrain.github.io/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a></span>
<span class=copyright-year>&copy;
2023
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg></i></span><span class=author>prayinforrain</span></span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.b4737d3fea0d0ccb989c84c2aca65bc3d77eb59f25f0a48ef906c1f9073845cd.js integrity="sha256-tHN9P+oNDMuYnITCrKZbw9d+tZ8l8KSO+QbB+Qc4Rc0=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
<script type=text/javascript src=//wcs.naver.net/wcslog.js></script>
<script type=text/javascript>if(!wcs_add)var wcs_add={};wcs_add.wa="1940c9395811670",window.wcs&&location.host===""&&wcs_do()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-63GYNX3VF5"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){if(location.host!=="")return;dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-63GYNX3VF5")</script></body></html>