<!doctype html><html lang=ko itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>마크다운 만들기 - contentEditable [1/3] - PrayinForRain.dev</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="prayinforrain"><meta name=description content="모헤윰의 에디터 만들기 시리즈 모아보기 에디터 만들기 - ContentEditable [1/3] 에디터 만들기 - getSelection [2/3] 에디터 만들기 - Markdown [3/3] 모헤윰의 핵심 기능 중 하나는 마크다운 서식 지원입니다. 왜 SNS에 마크다운을 끼얹을 생각을 했나 생각해보면 최초 기획부터 있다가 기능 다이어트를 한 후 살아남았기 때문인데, 아무튼 드디어 때가 왔습니다. 내부적으로 에디터를 외부 라이브러리를 사"><meta name=keywords content="Hugo,Frontend,React"><meta name=generator content="Hugo 0.110.0"><link rel=canonical href=http://prayinforrain.github.io/post/making-editor-contenteditable/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/sass/jane.min.8d5dfa68042d5ff1709fb357ce5dcd3a1e936cd0cd41e56c42c05afac5ca847c.css integrity="sha256-jV36aAQtX/Fwn7NXzl3NOh6TbNDNQeVsQsBa+sXKhHw=" media=screen crossorigin=anonymous><meta property="og:title" content="마크다운 만들기 - contentEditable [1/3]"><meta property="og:description" content="모헤윰의 에디터 만들기 시리즈 모아보기 에디터 만들기 - ContentEditable [1/3] 에디터 만들기 - getSelection [2/3] 에디터 만들기 - Markdown [3/3] 모헤윰의 핵심 기능 중 하나는 마크다운 서식 지원입니다. 왜 SNS에 마크다운을 끼얹을 생각을 했나 생각해보면 최초 기획부터 있다가 기능 다이어트를 한 후 살아남았기 때문인데, 아무튼 드디어 때가 왔습니다. 내부적으로 에디터를 외부 라이브러리를 사"><meta property="og:type" content="article"><meta property="og:url" content="http://prayinforrain.github.io/post/making-editor-contenteditable/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-11-22T20:36:55+09:00"><meta property="article:modified_time" content="2022-11-22T20:36:55+09:00"><meta itemprop=name content="마크다운 만들기 - contentEditable [1/3]"><meta itemprop=description content="모헤윰의 에디터 만들기 시리즈 모아보기 에디터 만들기 - ContentEditable [1/3] 에디터 만들기 - getSelection [2/3] 에디터 만들기 - Markdown [3/3] 모헤윰의 핵심 기능 중 하나는 마크다운 서식 지원입니다. 왜 SNS에 마크다운을 끼얹을 생각을 했나 생각해보면 최초 기획부터 있다가 기능 다이어트를 한 후 살아남았기 때문인데, 아무튼 드디어 때가 왔습니다. 내부적으로 에디터를 외부 라이브러리를 사"><meta itemprop=datePublished content="2022-11-22T20:36:55+09:00"><meta itemprop=dateModified content="2022-11-22T20:36:55+09:00"><meta itemprop=wordCount content="2798"><meta itemprop=keywords content="moheyum,"><meta name=twitter:card content="summary"><meta name=twitter:title content="마크다운 만들기 - contentEditable [1/3]"><meta name=twitter:description content="모헤윰의 에디터 만들기 시리즈 모아보기 에디터 만들기 - ContentEditable [1/3] 에디터 만들기 - getSelection [2/3] 에디터 만들기 - Markdown [3/3] 모헤윰의 핵심 기능 중 하나는 마크다운 서식 지원입니다. 왜 SNS에 마크다운을 끼얹을 생각을 했나 생각해보면 최초 기획부터 있다가 기능 다이어트를 한 후 살아남았기 때문인데, 아무튼 드디어 때가 왔습니다. 내부적으로 에디터를 외부 라이브러리를 사"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>prayinforrain.dev</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=http://prayinforrain.github.io/>Home</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://prayinforrain.github.io/post/>Archives</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://prayinforrain.github.io/tags/>Tags</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://prayinforrain.github.io/categories/>Categories</a></li><li class=mobile-menu-item><a class=menu-item-link href=http://prayinforrain.github.io/about/>About</a></li></ul></nav><link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css><link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class="header container"><div class=logo-wrapper><a href=/ class=logo>prayinforrain.dev</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=http://prayinforrain.github.io/>Home</a></li><li class=menu-item><a class=menu-item-link href=http://prayinforrain.github.io/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=http://prayinforrain.github.io/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=http://prayinforrain.github.io/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=http://prayinforrain.github.io/about/>About</a></li></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight wallpaper"><div class=content-wrapper><div id=content class="content container"><article class="post bg-white"><header class=post-header><h1 class=post-title>마크다운 만들기 - contentEditable [1/3]</h1><div class=post-meta><div class=post-meta-author>by
<a href=/about><span class=post-meta-author-name>prayinforrain</span></a></div><div class=post-meta-time title="2022-11-22 20:36:55"><time datetime=2022-11-22>2022-11-22</time></div><div class=post-meta__right><span class=post-meta-more>6 min read</span><div class=post-meta-category><a href=http://prayinforrain.github.io/categories/moheyum/>moheyum</a></div></div></div></header><div class=post-content><p><strong>모헤윰</strong>의 에디터 만들기 시리즈 모아보기<br><a href=http://prayinforrain.github.io/post/making-editor-contenteditable/>에디터 만들기 - ContentEditable [1/3]</a><br><a href=http://prayinforrain.github.io/post/making-editor-getselection/>에디터 만들기 - getSelection [2/3]</a><br><a href=http://prayinforrain.github.io/post/making-editor-markdown/>에디터 만들기 - Markdown [3/3]</a></p><hr><p>모헤윰의 핵심 기능 중 하나는 <code>마크다운 서식 지원</code>입니다. 왜 SNS에 마크다운을 끼얹을 생각을 했나 생각해보면 최초 기획부터 있다가 기능 다이어트를 한 후 살아남았기 때문인데, 아무튼 드디어 때가 왔습니다.</p><p>내부적으로 에디터를 외부 라이브러리를 사용하는게 좋지 않겠냐는 이야기가 나왔는데요, 결국 직접 구현해 보기로 했지만 그 과정에서 여러 레퍼런스를 얻을 수 있었습니다. 개인적으로 멋있다고 생각한 사이트 두 가지를 소개합니다.</p><p><a href=https://hackmd.io/>https://hackmd.io/</a><br><a href=https://ui.toast.com/tui-editor>https://ui.toast.com/tui-editor</a></p><h1 id=레퍼런스-살펴보기>레퍼런스 살펴보기</h1><p><img src=/image/md_editor_1_01.png alt=Untitled></p><p>놀랍게도 우리가 사용하는 에디터 중 <code>textarea</code>나 <code>input</code> 태그를 사용하는 경우는 거의 없습니다. 기껏해야 깃허브의 에디터가 <code>textarea</code>로 되어 있던 기억이 나네요. <code>textarea</code>의 가장 큰 문제는 입력 칸 안에 서식을 적용할 수 없다는 점이 되겠습니다. 다시 말해, <strong>syntax highlighting</strong>이 불가능합니다. 제가 아는 한에서는요.</p><p>그 문제를 우리는 <code>div</code> 태그에 <code>contenteditable</code> 속성을 통해 해결할 수 있습니다. <code>contenteditable</code>은 <code>div</code>를 <code>textarea</code>처럼 사용할 수 있게 해주며, 중간에 <code>span</code>같은 태그로 부분 스타일 적용이 가능합니다.</p><blockquote><p>💡 <code>contenteditable</code>을 적용하면 아래와 같은 메시지가 나타납니다.</p><p><strong>A component is <code>contentEditable</code> and contains <code>children</code> managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional.</strong></p><p>이는 <code>contenteditable</code>이 적용된 태그는 사용자의 입력에 따라 새 element가 늘기도 하고, 다시 줄어들기도 하기 때문에 React 엔진이 관리할 수 없으니 그로 인한 부작용은 너 알아서 해라 라고 말하는 메시지입니다. 이 element를 더 이상 React가 지켜줄 수 없다는 경고인데요, <code>contenteditable</code> 속성이 적용된 태그에 <code>suppressContentEditableWarning</code> 속성을 같이 달아주면 비활성화됩니다.</p></blockquote><h1 id=시작해보자>시작해보자</h1><p>그럼 이제 간단하게 contenteditable을 만들어 보겠습니다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span>&lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span>&gt;<span style=color:#a6e22e>Toolbar</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>contentEditable</span>&gt;<span style=color:#a6e22e>content</span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;button&#34;</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>submitHandler</span>}&gt;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>submit</span>
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>div</span>&gt;
</span></span></code></pre></td></tr></table></div></div><p><img src=/image/md_editor_1_02.png alt=Untitled>
<img src=/image/md_editor_1_03.png alt=Untitled></p><p>오.. 잘 됩니다. 왜 될까요?</p><p>개발자 도구로 까보니 개행 입력을 할 때마다 <code>div</code> 태그가 새로 생성되어 그 안에 내용이 입력되고 있습니다. 이러면 <code>contenteditable</code>이 걸린 <code>div</code>를 참조하여 <code>innerText</code>, <code>innerHTML</code>중 한 쪽을 선택해서 가져다가 사용하면 될 것 같습니다.</p><p><code>contenteditable</code>이 걸린 <code>div</code>에 css로 <code>display: inline-block;</code> 속성을 주면 개행이 <code>br</code>태그로 나눠진다고 하네요. 지금 저는 syntax highlight 기능까지 욕심을 내고 있기 때문에 부분 스타일 적용이 비교적 편해 보이는 <code>div</code>를 선택했습니다.</p><h2 id=changeevent가-없는-input>ChangeEvent가 없는 Input</h2><p>여기서 마주친 첫 번째 문제가 있었습니다. 위의 사진에서는 이쁘게 모든 행이 div태그에 감싸져 있었지만, 사실 모든 내용을 지우고 백스페이스를 한 번 더 누르면 첫 줄이 <code>contenteditable div</code> 자체의 innerText로 들어갈 수 있습니다. 무슨 소리냐면 아래 사진처럼 되는 것이죠.</p><p><img src=/image/md_editor_1_04.png alt=Untitled></p><p>이것은 큰 문제입니다. 우선 첫 줄만 저런 형태로 나오면 심리적인 불편함이 있고, 두번째로 나중에 <code>syntax-highlight</code>를 구현하게 된다면 첫 줄에 한정된 버그가 쏟아져 나올 위험이 있습니다. 그래서 delete나 백스페이스 입력으로 인해 내용이 없어지면 <code>&lt;div>&lt;br/>&lt;/div></code>로 초기화 되도록 <code>onChange</code> 리스너를 추가해야겠습니다. <code>&lt;br/></code>이 포함된 이유는 비어있는 <code>div</code> 태그로 초기화하면 입력할 때 그 안으로 입력이 되지 않기 때문입니다.</p><p>그런데 문제는, <code>contenteditable</code>은 <code>onChange</code>이벤트를 지원해주지 않습니다. 정확히는 애초에 <code>input</code> 태그가 아니기 때문에, 입력한 값에 대한 이벤트를 처리할 수가 없는 것이죠. 그렇기 때문에 <code>onKeyUp</code>, <code>onKeyDown</code>같은 Key 이벤트와 <code>contenteditable</code> 태그의 <code>innerHTML</code>에 접근하는 것으로 우회해서 구현하겠습니다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handleKeyUp</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>e</span>: <span style=color:#66d9ef>KeyboardEvent</span>&lt;<span style=color:#f92672>HTMLDivElement</span>&gt;) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>contentRef</span>.<span style=color:#a6e22e>current</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>key</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;Backspace&#34;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;Delete&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>contentRef</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>||</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>contentRef</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>
</span></span><span style=display:flex><span>    ) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>contentRef</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setContent</span>(<span style=color:#a6e22e>contentRef</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>innerText</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/\n\n/g</span>, <span style=color:#e6db74>&#34;\n&#34;</span>));
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p><img src=/image/md_editor_1_05.png alt=Untitled></p><p>잠깐의 테스트 끝에 문제가 해결되었음을 확인할 수 있었습니다.</p><h2 id=커서를-찾고-제어하기>커서를 찾고 제어하기</h2><p>이제 다 된걸까요? 때마침 게더타운에 있던 팀원분에게 결과를 공유했더니 <code>\t</code> 캐릭터 입력이 안되는 점이 아쉽다는 피드백을 주셨습니다. 음.. 마크다운 문법 자체가 개발자 친화적인 요소인데 탭키를 지원하지 않으면 곤란하니 한번 구현해 보겠습니다. 앞에서 했던 것처럼 <code>onKeyDown</code>으로 Tab 키를 가로채서 입력을 해주면 되지 않을까요? ..어? 근데 사용자 커서 위치에 탭키를 넣는 과정을 어떻게 구현할까요?</p><p>여기서 <code>window.getSelection()</code> 함수를 사용합니다. getSelection은 사용자의 커서가 어디에 있는지를 알려주는 함수인데요, 블록 지정을 했을 때, 단일 위치에 커서가 있을 때 각각 나누어서 위치 정보를 반환해 줍니다.</p><p><img src=/image/md_editor_1_06.png alt=Untitled></p><p>여기서 사용할 요소는 <code>anchorOffset</code>과 <code>focusOffset</code>입니다. <code>type</code>이 <strong>Caret</strong>일 경우 두 값은 똑같이 현재 커서 위치를 가리키며, <code>type</code>이 <strong>Range</strong>인, 즉 사용자가 드래그로 블록 지정을 한 경우에는 <code>anchorOffset</code>이 드래그 시작 지점, <code>focusOffset</code>이 드래그 종료 지점을 나타냅니다. 이걸 이용해서, 사용자의 커서 위치를 알아내서, 해당 위치의 node의 innerText를 제어하면 되겠습니다. 삽입 후에 <code>window.getSelection().collapse()</code>를 이용해 입력된 문자의 바로 뒤로 커서를 옮겨주면 더 좋겠네요!</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handleKeyDown</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>e</span>: <span style=color:#66d9ef>KeyboardEvent</span>&lt;<span style=color:#f92672>HTMLDivElement</span>&gt;) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>key</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cursor</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>getSelection</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>cursor</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;Tab&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>preventDefault</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>cursor</span>.<span style=color:#66d9ef>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;Caret&#34;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>cursor</span>.<span style=color:#a6e22e>anchorNode</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cursor</span>.<span style=color:#a6e22e>anchorOffset</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>cursor</span>.<span style=color:#a6e22e>anchorNode</span>.<span style=color:#a6e22e>textContent</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>cursor</span>.<span style=color:#a6e22e>anchorNode</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>textContent</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>slice</span>(
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>cursor</span>.<span style=color:#a6e22e>anchorOffset</span>
</span></span><span style=display:flex><span>      )<span style=color:#e6db74>}</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#e6db74>xa0</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#e6db74>xa0</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>cursor</span>.<span style=color:#a6e22e>anchorNode</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>textContent</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>slice</span>(<span style=color:#a6e22e>cursor</span>.<span style=color:#a6e22e>anchorOffset</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>      window.<span style=color:#a6e22e>getSelection</span>()<span style=color:#f92672>?</span>.<span style=color:#a6e22e>collapse</span>(<span style=color:#a6e22e>cursor</span>.<span style=color:#a6e22e>anchorNode</span>, <span style=color:#a6e22e>position</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p><code>\t</code> 문자를 입력하도록 했더니 탭을 연달아 입력하면 한 번만 입력이 처리되는 문제가 있어 공백 두 칸으로 대체하였습니다.</p><p><img src=/image/md_editor_1_07.png alt=Untitled></p><p>제대로 작동하는군요. 마음에 듭니다!</p><h2 id=입력-데이터를-만들자>입력 데이터를 만들자</h2><p>이제 마크다운을 변환하는 작업을 하는 함수에 사용자가 입력한 결과물을 넘겨주려고 합니다. 앞서 말했던 것처럼 <code>innerText</code>를 가져와서 보내면 될 것 같아요. 그런데 문제가 생겼습니다.</p><p><img src=/image/md_editor_1_08.png alt=Untitled></p><p>위 입력 결과의 innerText는 어떤 모습일까요?</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span>첫줄\n\n\n셋째줄\n
</span></span></code></pre></td></tr></table></div></div><p>이런.. <code>div</code> 자체가 한 줄로 입력이 되고 둘째줄 안의 <code>br</code> 태그가 개행문자를 하나 더 입력하고 있습니다. contenteditable은 빈 줄에 자동으로 <code>br</code>을 삽입하므로, 데이터를 넘기기 전에 정규표현식으로 연속된 개행문자를 하나로 합치는 작업을 거치겠습니다.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#a6e22e>setContent</span>(<span style=color:#a6e22e>contentRef</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>innerText</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/\n\n/g</span>, <span style=color:#e6db74>&#34;\n&#34;</span>));
</span></span></code></pre></td></tr></table></div></div><p>음, 이제 데이터가 잘 정제되었네요! 이대로 데이터를 넘겨주면 되겠습니다.</p><h1 id=서식을-어떻게-입힐까요>서식을 어떻게 입힐까요?</h1><p><img src=/image/md_editor_1_09.png alt=Untitled></p><p>정제한 입력값을 가지고, 정규표현식을 이용해 간단하게 <code>#</code>을 이용한 헤딩 마크다운을 추가했습니다. 그런데 이렇게 모든 규칙에 대해 코드를 하나씩 집어 넣는 방식이 좋은 방식일까요? <code>#</code>을 이용한 헤딩도 있지만 아랫줄에 <code>-</code> 또는 <code>=</code>를 입력해서 헤딩을 하는 것은 어떻게 구현할까요? 만약 헤딩과 코드블럭 마크다운이 중첩되면 어떻게 처리해야 할까요? 표를 그리는 방법은요?</p><p>생각만 해도 벌써 머리가 얼큰해지네요. 흠.. 갑자기 tokenizer, lexer, parser같은 키워드가 막 떠오르는데.. 다시 차분히 공부해 볼 필요가 있겠습니다. 다음 글의 내용이 벌써 짐작이 가는군요. 지금까지 <code>contenteditable</code>과 <code>getSelection()</code>을 활용한 과정에 대해 이야기해 보았습니다.</p></div><footer class=post-footer><div class=post-tags>tags:
<a href=http://prayinforrain.github.io/tags/moheyum/>moheyum</a></div><nav class=post-nav><a class=prev href=/post/making-editor-getselection/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg></i><span class="prev-text nav-default">마크다운 만들기 - getSelection [2/3]</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/emotion/><span class="next-text nav-default">Emotion</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg></i></a></nav></footer></article><div class="post bg-white"><script src=https://giscus.app/client.js data-repo=prayinforrain/prayinforrain.github.io data-repo-id=R_kgDOItUJmA data-category=Announcements data-category-id=DIC_kwDOItUJmM4CTXa0 data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></div></div></div></main><footer id=footer class=footer><div class=icon-links><a href=mailto:prayinforrain@naver.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg></a><a href=https://github.com/prayinforrain rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg></a><a href=http://prayinforrain.github.io/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a></span>
<span class=copyright-year>&copy;
2023
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg></i></span><span class=author>prayinforrain</span></span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/js/main.fe83e11b4fbc9193d67e2c9db78bad21f8dc59fca0cacd8c1c3bb071bb16a852.js integrity="sha256-/oPhG0+8kZPWfiydt4utIfjcWfygys2MHDuwcbsWqFI=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/load-photoswipe.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script>
<script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script>
<script type=text/javascript src=//wcs.naver.net/wcslog.js></script>
<script type=text/javascript>if(!wcs_add)var wcs_add={};wcs_add.wa="1940c9395811670",window.wcs&&wcs_do()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-63GYNX3VF5"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-63GYNX3VF5")</script></body></html>