<!doctype html><html lang=ko><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>마크다운 만들기 - contentEditable [1/3] | PrayinForRain.dev</title><meta property="og:title" content="마크다운 만들기 - contentEditable [1/3] | PrayinForRain.dev"><meta name=twitter:title content="마크다운 만들기 - contentEditable [1/3] | PrayinForRain.dev"><meta itemprop=name content="마크다운 만들기 - contentEditable [1/3] | PrayinForRain.dev"><meta name=application-name content="마크다운 만들기 - contentEditable [1/3] | PrayinForRain.dev"><meta property="og:site_name" content="PrayinforRain.dev"><meta name=description content="Dev blog of PrayinForRain, a KR frontend engineer"><meta itemprop=description content="Dev blog of PrayinForRain, a KR frontend engineer"><meta property="og:description" content="Dev blog of PrayinForRain, a KR frontend engineer"><meta name=twitter:description content="Dev blog of PrayinForRain, a KR frontend engineer"><meta property="og:locale" content="ko"><meta name=language content="ko"><meta itemprop=image content="https://prayinforrain.github.io/"><meta property="og:image" content="https://prayinforrain.github.io/"><meta name=twitter:image content="https://prayinforrain.github.io/"><meta name=twitter:image:src content="https://prayinforrain.github.io/"><meta property="og:type" content="article"><meta property="og:article:published_time" content="2022-11-22T20:36:55+0900"><meta property="article:published_time" content="2022-11-22T20:36:55+0900"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"마크다운 만들기 - contentEditable [1/3]","author":{"@type":"Person","name":""},"datePublished":"2022-11-22","description":"","wordCount":865,"mainEntityOfPage":"True","dateModified":"2022-11-22","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"PrayinForRain.dev"}}</script><meta name=generator content="Hugo 0.111.3"><link rel=canonical href=https://prayinforrain.github.io/posts/2022/11/making-editor-contenteditable/><link href=/sass/main.min.decbfe1bc29cf09a03d593072acc91448ef533c9ddd127977f9005a5eef1e35f.css rel=stylesheet><link href=/code-highlight.min.731e9fc351d3c45d032fb5f574575c296f67e08c1c6229b5ccbfd7bfb18217c5.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/images/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon/favicon-16x16.png><link rel=manifest href=/images/favicon/site.webmanifest><link rel=mask-icon href=/images/favicon/safari-pinned-tab.svg color=#5bbad5><link rel="shortcut icon" href=/images/favicon/favicon.ico><meta name=msapplication-TileColor content="#2b5797"><meta name=msapplication-config content="/images/favicon/browserconfig.xml"><meta name=theme-color content="#ffffff"><link rel=icon type=image/svg+xml href=/images/favicon/favicon.svg></head><body data-theme=light class=notransition><script src=https://prayinforrain.github.io/js/themeLoader.min.fe2d3ab854403d53528fe10728c59913f3c42213733cee4310332048995e6bf5.js></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=/ class=logo><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title>Home</title><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/posts/>Posts</a></li><li><a class=menu-link href=/tags/>Tags</a></li><li><a class=menu-link href=/about/>About</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>마크다운 만들기 - contentEditable [1/3]</h1><div class=post-meta><time datetime=2022-11-22T20:36:55+09:00 itemprop=datePublished>2022. 11. 22.</time></div></header><div class=page-content><p><strong>모헤윰</strong>의 에디터 만들기 시리즈 모아보기<br><a href=https://prayinforrain.github.io/posts/2022/11/making-editor-contenteditable/>에디터 만들기 - ContentEditable [1/3]</a><br><a href=https://prayinforrain.github.io/posts/2022/11/making-editor-getselection/>에디터 만들기 - getSelection [2/3]</a><br><a href=https://prayinforrain.github.io/posts/2022/12/making-editor-markdown/>에디터 만들기 - Markdown [3/3]</a></p><hr><p>모헤윰의 핵심 기능 중 하나는 <code>마크다운 서식 지원</code>입니다. 왜 SNS에 마크다운을 끼얹을 생각을 했나 생각해보면 최초 기획부터 있다가 기능 다이어트를 한 후 살아남았기 때문인데, 아무튼 드디어 때가 왔습니다.</p><p>내부적으로 에디터를 외부 라이브러리를 사용하는게 좋지 않겠냐는 이야기가 나왔는데요, 결국 직접 구현해 보기로 했지만 그 과정에서 여러 레퍼런스를 얻을 수 있었습니다. 개인적으로 멋있다고 생각한 사이트 두 가지를 소개합니다.</p><p><a href=https://hackmd.io/>https://hackmd.io/</a><br><a href=https://ui.toast.com/tui-editor>https://ui.toast.com/tui-editor</a></p><h1 id=레퍼런스-살펴보기>레퍼런스 살펴보기</h1><p><img src=/images/posts/2022/11/making-editor-contenteditable/md_editor_1_01.png alt=Untitled></p><p>놀랍게도 우리가 사용하는 에디터 중 <code>textarea</code>나 <code>input</code> 태그를 사용하는 경우는 거의 없습니다. 기껏해야 깃허브의 에디터가 <code>textarea</code>로 되어 있던 기억이 나네요. <code>textarea</code>의 가장 큰 문제는 입력 칸 안에 서식을 적용할 수 없다는 점이 되겠습니다. 다시 말해, <strong>syntax highlighting</strong>이 불가능합니다. 제가 아는 한에서는요.</p><p>그 문제를 우리는 <code>div</code> 태그에 <code>contenteditable</code> 속성을 통해 해결할 수 있습니다. <code>contenteditable</code>은 <code>div</code>를 <code>textarea</code>처럼 사용할 수 있게 해주며, 중간에 <code>span</code>같은 태그로 부분 스타일 적용이 가능합니다.</p><blockquote><p>💡 <code>contenteditable</code>을 적용하면 아래와 같은 메시지가 나타납니다.</p><p><strong>A component is <code>contentEditable</code> and contains <code>children</code> managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional.</strong></p><p>이는 <code>contenteditable</code>이 적용된 태그는 사용자의 입력에 따라 새 element가 늘기도 하고, 다시 줄어들기도 하기 때문에 React 엔진이 관리할 수 없으니 그로 인한 부작용은 너 알아서 해라 라고 말하는 메시지입니다. 이 element를 더 이상 React가 지켜줄 수 없다는 경고인데요, <code>contenteditable</code> 속성이 적용된 태그에 <code>suppressContentEditableWarning</code> 속성을 같이 달아주면 비활성화됩니다.</p></blockquote><h1 id=시작해보자>시작해보자</h1><p>그럼 이제 간단하게 contenteditable을 만들어 보겠습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>Toolbar</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>contentEditable</span><span class=p>&gt;</span><span class=nx>content</span><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span> <span class=na>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>submitHandler</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nx>submit</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><img src=/images/posts/2022/11/making-editor-contenteditable/md_editor_1_02.png alt=Untitled>
<img src=/images/posts/2022/11/making-editor-contenteditable/md_editor_1_03.png alt=Untitled></p><p>오.. 잘 됩니다. 왜 될까요?</p><p>개발자 도구로 까보니 개행 입력을 할 때마다 <code>div</code> 태그가 새로 생성되어 그 안에 내용이 입력되고 있습니다. 이러면 <code>contenteditable</code>이 걸린 <code>div</code>를 참조하여 <code>innerText</code>, <code>innerHTML</code>중 한 쪽을 선택해서 가져다가 사용하면 될 것 같습니다.</p><p><code>contenteditable</code>이 걸린 <code>div</code>에 css로 <code>display: inline-block;</code> 속성을 주면 개행이 <code>br</code>태그로 나눠진다고 하네요. 지금 저는 syntax highlight 기능까지 욕심을 내고 있기 때문에 부분 스타일 적용이 비교적 편해 보이는 <code>div</code>를 선택했습니다.</p><h2 id=changeevent가-없는-input>ChangeEvent가 없는 Input</h2><p>여기서 마주친 첫 번째 문제가 있었습니다. 위의 사진에서는 이쁘게 모든 행이 div태그에 감싸져 있었지만, 사실 모든 내용을 지우고 백스페이스를 한 번 더 누르면 첫 줄이 <code>contenteditable div</code> 자체의 innerText로 들어갈 수 있습니다. 무슨 소리냐면 아래 사진처럼 되는 것이죠.</p><p><img src=/images/posts/2022/11/making-editor-contenteditable/md_editor_1_04.png alt=Untitled></p><p>이것은 큰 문제입니다. 우선 첫 줄만 저런 형태로 나오면 심리적인 불편함이 있고, 두번째로 나중에 <code>syntax-highlight</code>를 구현하게 된다면 첫 줄에 한정된 버그가 쏟아져 나올 위험이 있습니다. 그래서 delete나 백스페이스 입력으로 인해 내용이 없어지면 <code>&lt;div>&lt;br/>&lt;/div></code>로 초기화 되도록 <code>onChange</code> 리스너를 추가해야겠습니다. <code>&lt;br/></code>이 포함된 이유는 비어있는 <code>div</code> 태그로 초기화하면 입력할 때 그 안으로 입력이 되지 않기 때문입니다.</p><p>그런데 문제는, <code>contenteditable</code>은 <code>onChange</code>이벤트를 지원해주지 않습니다. 정확히는 애초에 <code>input</code> 태그가 아니기 때문에, 입력한 값에 대한 이벤트를 처리할 수가 없는 것이죠. 그렇기 때문에 <code>onKeyUp</code>, <code>onKeyDown</code>같은 Key 이벤트와 <code>contenteditable</code> 태그의 <code>innerHTML</code>에 접근하는 것으로 우회해서 구현하겠습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>handleKeyUp</span> <span class=o>=</span> <span class=p>(</span><span class=nx>e</span>: <span class=kt>KeyboardEvent</span><span class=p>&lt;</span><span class=nt>HTMLDivElement</span><span class=p>&gt;)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>contentRef</span><span class=p>.</span><span class=nx>current</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>key</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>e</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>key</span> <span class=o>===</span> <span class=s2>&#34;Backspace&#34;</span> <span class=o>||</span> <span class=nx>key</span> <span class=o>===</span> <span class=s2>&#34;Delete&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>contentRef</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>===</span> <span class=s2>&#34;&#34;</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>      <span class=nx>contentRef</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>===</span> <span class=s2>&#34;&lt;br&gt;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>contentRef</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s2>&#34;&lt;div&gt;&lt;br/&gt;&lt;/div&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>setContent</span><span class=p>(</span><span class=nx>contentRef</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>innerText</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\n\n/g</span><span class=p>,</span> <span class=s2>&#34;\n&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><img src=/images/posts/2022/11/making-editor-contenteditable/md_editor_1_05.png alt=Untitled></p><p>잠깐의 테스트 끝에 문제가 해결되었음을 확인할 수 있었습니다.</p><h2 id=커서를-찾고-제어하기>커서를 찾고 제어하기</h2><p>이제 다 된걸까요? 때마침 게더타운에 있던 팀원분에게 결과를 공유했더니 <code>\t</code> 캐릭터 입력이 안되는 점이 아쉽다는 피드백을 주셨습니다. 음.. 마크다운 문법 자체가 개발자 친화적인 요소인데 탭키를 지원하지 않으면 곤란하니 한번 구현해 보겠습니다. 앞에서 했던 것처럼 <code>onKeyDown</code>으로 Tab 키를 가로채서 입력을 해주면 되지 않을까요? ..어? 근데 사용자 커서 위치에 탭키를 넣는 과정을 어떻게 구현할까요?</p><p>여기서 <code>window.getSelection()</code> 함수를 사용합니다. getSelection은 사용자의 커서가 어디에 있는지를 알려주는 함수인데요, 블록 지정을 했을 때, 단일 위치에 커서가 있을 때 각각 나누어서 위치 정보를 반환해 줍니다.</p><p><img src=/images/posts/2022/11/making-editor-contenteditable/md_editor_1_06.png alt=Untitled></p><p>여기서 사용할 요소는 <code>anchorOffset</code>과 <code>focusOffset</code>입니다. <code>type</code>이 <strong>Caret</strong>일 경우 두 값은 똑같이 현재 커서 위치를 가리키며, <code>type</code>이 <strong>Range</strong>인, 즉 사용자가 드래그로 블록 지정을 한 경우에는 <code>anchorOffset</code>이 드래그 시작 지점, <code>focusOffset</code>이 드래그 종료 지점을 나타냅니다. 이걸 이용해서, 사용자의 커서 위치를 알아내서, 해당 위치의 node의 innerText를 제어하면 되겠습니다. 삽입 후에 <code>window.getSelection().collapse()</code>를 이용해 입력된 문자의 바로 뒤로 커서를 옮겨주면 더 좋겠네요!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>handleKeyDown</span> <span class=o>=</span> <span class=p>(</span><span class=nx>e</span>: <span class=kt>KeyboardEvent</span><span class=p>&lt;</span><span class=nt>HTMLDivElement</span><span class=p>&gt;)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>key</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>e</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>cursor</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>getSelection</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>cursor</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>key</span> <span class=o>===</span> <span class=s2>&#34;Tab&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>e</span><span class=p>.</span><span class=nx>preventDefault</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>cursor</span><span class=p>.</span><span class=kr>type</span> <span class=o>===</span> <span class=s2>&#34;Caret&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>cursor</span><span class=p>.</span><span class=nx>anchorNode</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>position</span> <span class=o>=</span> <span class=nx>cursor</span><span class=p>.</span><span class=nx>anchorOffset</span> <span class=o>+</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>cursor</span><span class=p>.</span><span class=nx>anchorNode</span><span class=p>.</span><span class=nx>textContent</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>cursor</span><span class=p>.</span><span class=nx>anchorNode</span><span class=o>?</span><span class=p>.</span><span class=nx>textContent</span><span class=o>?</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>cursor</span><span class=p>.</span><span class=nx>anchorOffset</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span><span class=si>}</span><span class=err>\</span><span class=sb>xa0</span><span class=err>\</span><span class=sb>xa0</span><span class=si>${</span><span class=nx>cursor</span><span class=p>.</span><span class=nx>anchorNode</span><span class=o>?</span><span class=p>.</span><span class=nx>textContent</span><span class=o>?</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=nx>cursor</span><span class=p>.</span><span class=nx>anchorOffset</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nb>window</span><span class=p>.</span><span class=nx>getSelection</span><span class=p>()</span><span class=o>?</span><span class=p>.</span><span class=nx>collapse</span><span class=p>(</span><span class=nx>cursor</span><span class=p>.</span><span class=nx>anchorNode</span><span class=p>,</span> <span class=nx>position</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><code>\t</code> 문자를 입력하도록 했더니 탭을 연달아 입력하면 한 번만 입력이 처리되는 문제가 있어 공백 두 칸으로 대체하였습니다.</p><p><img src=/images/posts/2022/11/making-editor-contenteditable/md_editor_1_07.png alt=Untitled></p><p>제대로 작동하는군요. 마음에 듭니다!</p><h2 id=입력-데이터를-만들자>입력 데이터를 만들자</h2><p>이제 마크다운을 변환하는 작업을 하는 함수에 사용자가 입력한 결과물을 넘겨주려고 합니다. 앞서 말했던 것처럼 <code>innerText</code>를 가져와서 보내면 될 것 같아요. 그런데 문제가 생겼습니다.</p><p><img src=/images/posts/2022/11/making-editor-contenteditable/md_editor_1_08.png alt=Untitled></p><p>위 입력 결과의 innerText는 어떤 모습일까요?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>첫줄\n\n\n셋째줄\n
</span></span></code></pre></div><p>이런.. <code>div</code> 자체가 한 줄로 입력이 되고 둘째줄 안의 <code>br</code> 태그가 개행문자를 하나 더 입력하고 있습니다. contenteditable은 빈 줄에 자동으로 <code>br</code>을 삽입하므로, 데이터를 넘기기 전에 정규표현식으로 연속된 개행문자를 하나로 합치는 작업을 거치겠습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=nx>setContent</span><span class=p>(</span><span class=nx>contentRef</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>innerText</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/\n\n/g</span><span class=p>,</span> <span class=s2>&#34;\n&#34;</span><span class=p>));</span>
</span></span></code></pre></div><p>음, 이제 데이터가 잘 정제되었네요! 이대로 데이터를 넘겨주면 되겠습니다.</p><h1 id=서식을-어떻게-입힐까요>서식을 어떻게 입힐까요?</h1><p><img src=/images/posts/2022/11/making-editor-contenteditable/md_editor_1_09.png alt=Untitled></p><p>정제한 입력값을 가지고, 정규표현식을 이용해 간단하게 <code>#</code>을 이용한 헤딩 마크다운을 추가했습니다. 그런데 이렇게 모든 규칙에 대해 코드를 하나씩 집어 넣는 방식이 좋은 방식일까요? <code>#</code>을 이용한 헤딩도 있지만 아랫줄에 <code>-</code> 또는 <code>=</code>를 입력해서 헤딩을 하는 것은 어떻게 구현할까요? 만약 헤딩과 코드블럭 마크다운이 중첩되면 어떻게 처리해야 할까요? 표를 그리는 방법은요?</p><p>생각만 해도 벌써 머리가 얼큰해지네요. 흠.. 갑자기 tokenizer, lexer, parser같은 키워드가 막 떠오르는데.. 다시 차분히 공부해 볼 필요가 있겠습니다. 다음 글의 내용이 벌써 짐작이 가는군요. 지금까지 <code>contenteditable</code>과 <code>getSelection()</code>을 활용한 과정에 대해 이야기해 보았습니다.</p></div></article><article id=giscus-wrapper></article><script>const giscus_light="https://cdn.jsdelivr.net/gh/prayinforrain/prayinforrain.github.io@main/static/styles/_giscus.css",giscus_dark="https://cdn.jsdelivr.net/gh/prayinforrain/prayinforrain.github.io@main/static/styles/_giscus_dark.css";let giscusTheme=localStorage.getItem("theme");giscusTheme||(giscusTheme="light",window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(defaultTheme="dark"));let giscusAttributes={src:"https://giscus.app/client.js","data-repo":"prayinforrain/prayinforrain.github.io","data-repo-id":"R_kgDOItUJmA","data-category":"Announcements","data-category-id":"DIC_kwDOItUJmM4CTXa0","data-mapping":"pathname","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":giscusTheme==="dark"?giscus_dark:giscus_light,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([e,t])=>giscusScript.setAttribute(e,t)),document.getElementById("giscus-wrapper").appendChild(giscusScript)</script></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/prayinforrain target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=mailto:prayinforrain@naver.com target=_blank rel="noopener noreferrer me" title=Email><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2023 PrayinforRain.
Powered by <a href=https://github.com/hugo-sid/hugo-blog-awesome target=_blank rel="noreferrer noopener">Hugo blog awesome</a>
theme on
<a href=https://gohugo.io target=_blank rel="noreferrer noopener">Hugo</a>.</small></footer><script src=https://prayinforrain.github.io/js/themeSwitchnMenu.min.2a3c1435c7eb437003947a7d137c5976f629ecfbaad5fa4ed295bbaa16828f02.js></script></body></html>