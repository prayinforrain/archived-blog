<!doctype html><html lang=ko><head><meta charset=utf-8><meta http-equiv=content-type content="text/html"><meta name=viewport content="width=device-width,initial-scale=1"><title itemprop=name>마크다운 만들기 - getSelection [2/3] | PrayinForRain.dev</title><meta property="og:title" content="마크다운 만들기 - getSelection [2/3] | PrayinForRain.dev"><meta name=twitter:title content="마크다운 만들기 - getSelection [2/3] | PrayinForRain.dev"><meta itemprop=name content="마크다운 만들기 - getSelection [2/3] | PrayinForRain.dev"><meta name=application-name content="마크다운 만들기 - getSelection [2/3] | PrayinForRain.dev"><meta property="og:site_name" content="PrayinforRain.dev"><meta name=description content="Dev blog of PrayinForRain, a KR frontend engineer"><meta itemprop=description content="Dev blog of PrayinForRain, a KR frontend engineer"><meta property="og:description" content="Dev blog of PrayinForRain, a KR frontend engineer"><meta name=twitter:description content="Dev blog of PrayinForRain, a KR frontend engineer"><meta property="og:locale" content="ko"><meta name=language content="ko"><meta itemprop=image content="https://prayinforrain.github.io/avatar.png"><meta property="og:image" content="https://prayinforrain.github.io/avatar.png"><meta name=twitter:image content="https://prayinforrain.github.io/avatar.png"><meta name=twitter:image:src content="https://prayinforrain.github.io/avatar.png"><meta property="og:type" content="article"><meta property="og:article:published_time" content="2022-11-24T00:53:55+0900"><meta property="article:published_time" content="2022-11-24T00:53:55+0900"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"마크다운 만들기 - getSelection [2/3]","author":{"@type":"Person","name":""},"datePublished":"2022-11-24","description":"","wordCount":1020,"mainEntityOfPage":"True","dateModified":"2022-11-24","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"PrayinForRain.dev"}}</script><meta name=generator content="Hugo 0.113.0"><link rel=canonical href=https://prayinforrain.github.io/posts/2022/11/making-editor-getselection/><link href=/style.min.f6493eb583443cb666face0d916c37c3ef62ac15202265d7e0150f4759fe70a8.css rel=stylesheet><link href=/code-highlight.min.731e9fc351d3c45d032fb5f574575c296f67e08c1c6229b5ccbfd7bfb18217c5.css rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/icons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/icons/favicon-16x16.png><link rel=mask-icon href=/icons/safari-pinned-tab.svg><link rel="shortcut icon" href=/favicon.ico><link rel=manifest href=https://prayinforrain.github.io/site.webmanifest><meta name=msapplication-config content="/browserconfig.xml"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#434648"><link rel=icon type=image/svg+xml href=/icons/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-63GYNX3VF5"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-63GYNX3VF5",{anonymize_ip:!1})}</script><script type=text/javascript src=//wcs.naver.net/wcslog.js></script>
<script type=text/javascript>if(!wcs_add)var wcs_add={};wcs_add.wa="1940c9395811670",window.wcs&&location.host==="prayinforrain.github.io"&&wcs_do()</script></head><body data-theme=auto class=notransition><script src=/js/theme.min.d17e61995c7d9fee9a7b0e77c95447101fe27fa434c458fab370732da48b2b17.js integrity="sha256-0X5hmVx9n+6aew53yVRHEB/if6Q0xFj6s3BzLaSLKxc="></script><div class=navbar role=navigation><nav class=menu aria-label="Main Navigation"><a href=https://prayinforrain.github.io/ class=logo><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><title>Home</title><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></a><input type=checkbox id=menu-trigger class=menu-trigger>
<label for=menu-trigger><span class=menu-icon><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentcolor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7H3.40726"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"/><path stroke-linecap="round" stroke-linejoin="round" d="M.5 12.5V1.5c0-.552285.447715-1 1-1h11C13.0523.5 13.5.947715 13.5 1.5v11C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C.947715 13.5.5 13.0523.5 12.5z"/></svg></span></label><div class=trigger><ul class=trigger-container><li><a class=menu-link href=/>Home</a></li><li><a class="menu-link active" href=/posts/>Posts</a></li><li><a class=menu-link href=/tags/>Tags</a></li><li><a class=menu-link href=/about/>About</a></li><li class=menu-separator><span>|</span></li></ul><a id=mode href=#><svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1"><title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1=".5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1=".5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"/><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"/></g></svg></a></div></nav></div><div class="wrapper post"><main class=page-content aria-label=Content><article><header class=header><h1 class=header-title>마크다운 만들기 - getSelection [2/3]</h1><div class=post-meta><time datetime=2022-11-24T00:53:55+09:00 itemprop=datePublished>2022. 11. 24.</time></div></header><details class=toc><summary><b>Table of Contents</b></summary><nav id=TableOfContents><ul><li><a href=#-첫-단추가-중요하다>😢 첫 단추가 중요하다</a></li><li><a href=#-windowsgetselection>🖱️ windows.getSelection()</a><ul><li><a href=#contenteditable의-문제>contenteditable의 문제</a></li><li><a href=#type-selection>type Selection</a></li><li><a href=#anchornode는-node다>anchorNode는 node다</a><ul><li><a href=#텍스트-노드를-아시나요>텍스트 노드를 아시나요?</a></li></ul></li><li><a href=#nodenodetype>Node.nodeType</a></li></ul></li><li><a href=#-오버엔지니어링의-길목에서>🤦 오버엔지니어링의 길목에서</a></li></ul></nav></details><div class=page-content><p><strong>모헤윰</strong>의 에디터 만들기 시리즈 모아보기<br><a href=https://prayinforrain.github.io/posts/2022/11/making-editor-contenteditable/>에디터 만들기 - ContentEditable [1/3]</a><br><a href=https://prayinforrain.github.io/posts/2022/11/making-editor-getselection/>에디터 만들기 - getSelection [2/3]</a><br><a href=https://prayinforrain.github.io/posts/2022/12/making-editor-markdown/>에디터 만들기 - Markdown [3/3]</a></p><hr><p>아니???????? 두 번째 글이 파서가 아니였네요. 저는 사실 이 글이 2부작이길 간절히 바랬는데, 1편에서 만든 에디터에 너무 끔찍한 버그가 있어서 이에 대해 정리해 보고자 합니다. 이걸로 3시간을 씨름하고 있었지만 모헤윰의 TIL 문서가 풍성해지고 있으니 긍정적이게 생각해야겠죠?</p><blockquote><p>💡 이 글은 Window 10, Chrome 107.0.5304.107 버전을 기준으로 작성되었습니다. 일부 환경에 따라 다르게 작동하는 부분이 있을 수 있습니다.</p></blockquote><h1 id=-첫-단추가-중요하다>😢 첫 단추가 중요하다</h1><p><img src=/images/posts/2022/11/making-editor-getselection/md_editor_2_01.png alt=Untitled></p><p>지금 만든 <code>contenteditable div</code>는 치명적 문제가 있습니다. <code>contenteditable</code>이 사진처럼 첫 줄의 텍스트를 div 태그로 감싸주지 않는다고 언급한 문제가 기억 나시나요? 사실 저는 처음 글에서 첫 줄 문제가 해결된 척 이야기한 바 있죠. 특정 상황에서는 여전히 <code>contenteditable div</code>에 직접 텍스트를 입력할 수 있었지만, 솔직하게 그 때는 어차피 syntax highlighting을 지원하지 않을 거라 생각해 쉬쉬하기로 했습니다. 그런데 아니나 다를까, 붙여넣기에서 문제가 발생했습니다.</p><p><img src=/images/posts/2022/11/making-editor-getselection/md_editor_2_02.png alt=Untitled></p><p>아무 입력도 되어 있지 않은 <code>contenteditable div</code>에 붙여넣기를 하면 위와 같은 오류가 납니다. 이 상태에서 다시 붙여넣기를 하면 그 때부턴 정상적으로 작동하는데, 어차피 이런 에러 쯤이야 콘솔을 열어놓고 웹서핑을 하는 개발자가 아니고서야 무시할 수 있는 수준이니 넘어갈 수 있겠지만, 결정적으로 붙여넣기 후 <strong>커서가 붙여넣기 한 글귀의 끝으로 이동하지 않았습니다</strong>. 아니나 다를까 탭 키에 대해서 구현했던 코드도 같은 오류가 있네요.</p><p>오늘은 이 오류의 원인과 해결 과정에 대해 기록하는 글을 써 보겠습니다.</p><h1 id=-windowsgetselection>🖱️ windows.getSelection()</h1><h2 id=contenteditable의-문제>contenteditable의 문제</h2><p>저번 글에서 공부했던 바와 같이, <code>contenteditable div</code>는 일반적인 입력 동작이 제대로 이루어지지 않습니다. 착한 사용자가 차분히 글을 입력한다고 해도 첫 줄만 <code>div</code> 태그로 감싸주지 않는다거나, 붙여넣기를 하면 대뜸 원본의 서식이 그대로 적용된 글귀가 입력되기도 합니다.</p><p><img src=/images/posts/2022/11/making-editor-getselection/md_editor_2_03.png alt=Untitled></p><p>대충 이런 느낌이죠. 그 외에도 수정을 어떻게 하느냐에 따라 결과물이 묘하게 달라지기도 하는 등, 너무나 다양한 문제가 산재해 있습니다. 서론이 너무 길었네요. 그냥 <code>con..어쩌구</code>에 대해 처음 글을 쓸 때 이런 문제들이 있다고 설명할 걸 그랬어요.</p><p>아무튼 이런 불쾌한 동작들을 해결하기 위해, <code>keydown</code>, <code>keyup</code>, <code>paste</code> 등 다양한 이벤트 리스너를 바인딩해서 직접 이런 제스쳐를 구현해야만 했습니다. 그 과정에서 소개했던 것이 바로 <code>windows.getSelection()</code>이였죠.</p><p><img src=/images/posts/2022/11/making-editor-getselection/md_editor_2_04.png alt=Untitled></p><h2 id=type-selection>type Selection</h2><p>우선 이 녀석이 제공해주는 <code>Selection</code> 타입 객체의 property를 보겠습니다.</p><table><thead><tr><th>이름</th><th>설명</th></tr></thead><tbody><tr><td>anchorNode</td><td>선택이 시작된 지점(=드래그 시작 지점)의 노드를 참조합니다.</td></tr><tr><td>anchorOffset</td><td>선택이 시작된 지점의 anchorNode상에서의 위치를 나타냅니다.</td></tr><tr><td>focusNode</td><td>선택이 끝난 지점(=드래그 종료 지점)의 노드를 참조합니다.</td></tr><tr><td>focusOffset</td><td>선택이 끝난 지점의 focusNode상에서의 위치를 나타냅니다.</td></tr><tr><td>type</td><td>블록 지정시 Range, 단일 커서는 Caret을 갖습니다.</td></tr></tbody></table><p>큰 의미 없거나 정식 스펙이 아닌 경우는 제외하고 이 정도를 알고 있으면 되겠습니다. 드래그 시작과 종료 지점을 명시한 이유는 저번 글에서 언급했던 것처럼 드래그에는 방향이 있기 때문이죠. Caret의 경우에는 항상 두 프로퍼티가 같은 값을 가질 것입니다.</p><p><code>Selection</code> 타입은 제공하는 method도 있습니다. 한번 알아보겠습니다.</p><table><thead><tr><th>이름</th><th>설명</th></tr></thead><tbody><tr><td>getRangeAt(index)</td><td>현재 선택된 index번째 Range 범위를 반환합니다. 다중 선택이 지원되는 브라우저가 아닌 경우 보통 index는 0이 최대입니다.</td></tr><tr><td>addRange(range)</td><td>현재 선택된 Range에 더해 range를 함께 선택합니다. 다중 선택이 지원되는 브라우저가 아닌 경우 range만이 재선택됩니다.</td></tr><tr><td>collapse(node, offset?)</td><td>node의 offset 위치를 선택합니다.</td></tr><tr><td>containsNode(node, partialContainment?)</td><td>node가 선택 Range 안에 포함되는지 여부를 반환합니다. partialContainment가 true인 경우 일부만 포함되어 있어도 true를 반환합니다.</td></tr></tbody></table><p>훨씬 종류가 많지만 쓰이지 않을 것 같아 길게 적지 않았습니다. 그 외에 <code>Selection</code> 타입 객체는 각 프로퍼티에 대해 얕은 참조를 제공하기 때문에 같은 이름으로 참조해도 참조 시점에 따라 값이 변할 수 있다는 특성이 있겠네요. 여기서 제가 사용했던 메소드는 <code>collapse</code>였습니다. 대충 <code>getSelection()</code>으로 받은 <code>anchorNode</code>를 그대로 사용하고, <code>anchorOffset + 추가한 문자열 길이</code>로 위치를 잡는 식이죠.</p><h2 id=anchornode는-node다>anchorNode는 node다</h2><p>그런데 이 <code>anchorOffset</code>은 상황에 따라 다르게 사용해야 합니다. 이게 무슨 소리냐면, 이 녀석을 1로 지정하면 커서가 끝으로 갈 때가 있고, 두 번째 글자로 커서가 이동할 때가 있다는 말이죠.</p><p><img src=/images/posts/2022/11/making-editor-getselection/md_editor_2_05.gif alt=복사맨2.gif></p><p>두 번째 글자로 커서가 가는건 이해가 가는데, 처음엔 왜 끝으로 갔던 걸까요? 그 비밀은 <code>getSelection</code>이 참조하던 <code>anchorNode</code>에 있습니다. <strong>첫 번째 붙여넣기와 그 이후의 붙여넣기의 anchorNode가 다르기 때문</strong>이죠. 첫 번째 붙여넣기는 <code>contenteditable div</code>를, 그 이후에는 해당 라인의 div..도 아니라 <code>그 div의 **텍스트 노드**</code>를 참조하고 있습니다.</p><h3 id=텍스트-노드를-아시나요>텍스트 노드를 아시나요?</h3><p>위에 제가 <code>console.log</code>를 찍어본 사진에는 <code>anchorNode</code>에 <code>text</code>라고 쓰여 있었습니다. 저는 <code>contenteditable div</code>의 자식 <code>div</code>중 하나를 선택하고 있었는데 말이죠. 즉 <code>getSelection</code>은 선택중인 텍스트 노드까지 따져서 참조한다는 특징을 알 수 있습니다. 텍스트 노드라.. 딱히 어느 태그에 포함되어 있지 않으면서 애매하게 텍스트만 들어있는 바로 그 <code>innerText</code>를 텍스트 노드라고 부르는 모양입니다.</p><p><img src=/images/posts/2022/11/making-editor-getselection/md_editor_2_06.png alt=Untitled></p><p>바로 요 녀석인데요, 텍스트 노드는 다른 노드와 다르게 조금 특이한 성질을 갖습니다. 다르다고 하나, 아무튼 Node 인터페이스를 상속하지만 HTML Element는 아니기 때문에 다루기가 굉장히 까다롭습니다.</p><ul><li>innerText가 비어있는, 즉 <code>‘’</code>인 Element는 텍스트 노드가 없습니다.</li><li>부모의 <code>childNodes</code>같은 프로퍼티로 접근할 수 있지만, 고정된 인덱스에 있지는 않습니다.<ul><li>즉 다른 형제 노드와의 순서에 따라 인덱스가 변합니다..</li></ul></li></ul><p>다시 돌아와서 <code>collapse</code>에 제공한 <code>offset</code>이 어째서 텍스트 상의 위치를 가리키지 않았느냐, 노드상에서의 <strong>offset은 텍스트 노드를 제외하고는 자식 노드의 인덱스를 가리키기 때문</strong>이죠. 즉 아래 과정과 같습니다.</p><p>첫 번째 복사했을 때에는 <code>anchorNode</code>가 <code>contenteditable div</code>였기 때문에, <code>offset = 1</code>에 해당하는 위치는 아래와 같습니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>contenteditable</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>textNode</span><span class=p>&gt;</span><span class=err>복사한</span> <span class=err>글귀입니다</span><span class=p>&lt;/</span><span class=nt>textNode</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=c>&lt;!--</span> <span class=err>여기</span><span class=o>!</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>이렇게 커서를 이동시키고 나면, <code>div</code> 태그 안의 입력은 모두 텍스트 노드 안으로 들어가게 되므로 커서는 텍스트 노드가 끝나기 직전 위치로 자동으로 보정되게 됩니다. 표현하자면 아래처럼 되겠군요.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>contenteditable</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>textNode</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=err>복사한</span> <span class=err>글귀입니다</span>
</span></span><span class=line><span class=cl>		<span class=c>&lt;!--</span> <span class=err>여기</span><span class=o>!</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>textNode</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>이 상태에서 한번 더 붙여넣기를 한다면 끝에 자연스럽게 붙여넣기가 되지만, 이번에 참조하는 <code>anchorNode</code>는 텍스트노드로 변경되어 offset이 가리키는 위치는 처음 원했던 바로 그 텍스트에서의 위치가 됩니다. 두 번째 붙여넣기를 완료한 후의 커서 상태는 아래와 같이 됩니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>contenteditable</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>textNode</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>		<span class=err>복</span><span class=c>&lt;!--</span> <span class=err>여기</span><span class=o>!</span> <span class=o>--&gt;</span><span class=err>사한</span> <span class=err>글귀입니다복사한</span> <span class=err>글귀입니다</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;/</span><span class=nt>textNode</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>정말 끔찍하군요. offset이 노드의 타입에 따라 다르게 적용된다니! 아니 그 이전에 왜 <code>anchorNode</code>는 처음부터 텍스트노드를 잡아 주지 않는거죠?</p><h2 id=nodenodetype>Node.nodeType</h2><p>다행히 이 문제를 바로잡을 방법이 있었습니다. 바로 Node 인터페이스가 제공하는 <code>nodeType</code>인데요, 이 녀석이 1이면 Element, 3이면 Text 노드라고 하네요. 그 말인 즉 <code>anchorNode</code>가 1이거나 3일 때 다른 한 쪽으로 변환해서 통일해주면 되는데.. 앞에서 언급했듯 텍스트 노드는 참조하는 것 자체가 여간 어려운 일이 아닙니다. 그래서 제가 해결한 방법은 <code>nodeType</code>에 따라 offset을 다르게 사용하는 것입니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>position</span> <span class=o>=</span> <span class=nx>anchorNode</span><span class=p>.</span><span class=nx>nodeType</span> <span class=o>===</span> <span class=mi>3</span> <span class=o>?</span> <span class=nx>anchorOffset</span> <span class=o>+</span> <span class=nx>data.length</span> : <span class=kt>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>getSelection</span><span class=p>()</span><span class=o>?</span><span class=p>.</span><span class=nx>collapse</span><span class=p>(</span><span class=nx>anchorNode</span><span class=p>,</span> <span class=nx>position</span><span class=p>);</span>
</span></span></code></pre></div><p>텍스트 노드이면 정상적으로 길이를 더해서 끝자리를 잡아주고, 엘리먼트이면 1의 offset을 대입합니다. 이게 가능한 이유는 이 문제가 발생하는 케이스가 빈 칸에 최초 입력 시에만 발생하기 때문인데, 새로운 케이스가 발견되면 저 1을 무척 피곤하고 귀찮은 변수로 바꿔 주어야 겠네요.</p><h1 id=-오버엔지니어링의-길목에서>🤦 오버엔지니어링의 길목에서</h1><p><img src=/images/posts/2022/11/making-editor-getselection/md_editor_2_07.gif alt=고쳤맨.gif></p><p>처음에는 아주 간단한 에디터를 생각했는데, 그 <em>간단한</em> 에디터 뒤에 얼마나 깊은 심연이 있는지 몸소 두들겨 맞게 되는 요즘입니다. <code>input</code>이나 <code>textarea</code>를 썼으면 이런 긴 글을 두 개나 쓸 필요가 없었을텐데, 제가 무슨 부귀영화를 누리자고 <code>contenteditable</code>을 쓰자고 했을까요?</p><p>그럼에도 불구하고 새로운 경험을 하고 글을 쓸 수 있어서 정말 즐겁습니다. 데모 발표 시간에도 제가 즐거워해야 할텐데요, 다음 글은 드디어 마크다운을 파싱하는 과정에 대해 써볼 예정입니다. 지금 어느 난관에 부딪혀 멈춰 있는데, 여유가 된다면 아마 6주차에 리팩토링을 할 것 같네요. 화이팅!</p></div></article><article id=giscus-wrapper></article><script>const giscus_light="https://cdn.jsdelivr.net/gh/prayinforrain/prayinforrain.github.io@main/static/styles/_giscus.css",giscus_dark="https://cdn.jsdelivr.net/gh/prayinforrain/prayinforrain.github.io@main/static/styles/_giscus_dark.css";let giscusTheme=localStorage.getItem("theme");giscusTheme||(giscusTheme="light",window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(defaultTheme="dark"));let giscusAttributes={src:"https://giscus.app/client.js","data-repo":"prayinforrain/prayinforrain.github.io","data-repo-id":"R_kgDOItUJmA","data-category":"Announcements","data-category-id":"DIC_kwDOItUJmM4CTXa0","data-mapping":"pathname","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":giscusTheme==="dark"?giscus_dark:giscus_light,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([e,t])=>giscusScript.setAttribute(e,t)),document.getElementById("giscus-wrapper").appendChild(giscusScript)</script></main></div><footer class=footer><span class=footer_item></span>&nbsp;<div class=footer_social-icons><a href=https://github.com/prayinforrain target=_blank rel="noopener noreferrer me" title=Github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=mailto:prayinforrain@naver.com target=_blank rel="noopener noreferrer me" title=Email><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 21" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=index.xml target=_blank rel="noopener noreferrer me" title=Rss><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div><small class=footer_copyright>© 2023 PrayinforRain.
Powered by <a href=https://github.com/hugo-sid/hugo-blog-awesome target=_blank rel="noreferrer noopener">Hugo blog awesome</a>
theme on
<a href=https://gohugo.io target=_blank rel="noreferrer noopener">Hugo</a>.</small></footer><a href=# title="Go to top" id=totop><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentcolor" stroke="currentcolor" viewBox="0 96 960 960"><path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197z"/></svg></a><script src=https://prayinforrain.github.io/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30+lSNuSkl4QXuNyy8="></script>
<script src=https://prayinforrain.github.io/js/custom.min.d9a0ea0a65c1b01e922173e72cd81eedad8ae4b3ca9396e95f24b6e7d29a94c8.js integrity="sha256-2aDqCmXBsB6SIXPnLNge7a2K5LPKk5bpXyS259KalMg="></script></body></html>